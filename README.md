# LNU-URP 辽宁大学教务系统自动抢课脚本

## ⚠️ 免责声明

**本项目仅供技术学习和研究使用，严禁用于任何违法违规行为。**

使用本脚本即表示您同意以下条款：
1. 本脚本仅用于个人学习和技术研究，不得用于任何商业用途
2. 使用者需遵守所在学校的相关规定和法律法规
3. 因使用本脚本造成的任何后果由使用者自行承担
4. 开发者不承担任何因使用本脚本而产生的法律责任
5. 请合理使用，避免对服务器造成过大压力

## 📖 项目简介

LNU-URP 是一个针对辽宁大学教务系统的自动化工具集，支持自动登录、验证码识别、课程选择、成绩查询、自动评教等功能。该项目采用模块化设计，具有良好的容错机制和网络稳定性。

### 主要功能

- 🔐 **自动登录**: 支持自动填入账号密码并进行MD5加密
- 🔍 **验证码识别**: 使用ddddocr进行自动验证码识别
- 📚 **批量选课**: 支持根据配置文件批量选择课程
- 🔄 **自动重试**: 内置网络重试机制，提高成功率
- 📊 **成绩查询**: 支持查询全部或指定学期成绩
- ❓ **自动答题**: 自动处理教务系统中的问卷调查
- 📝 **自动评教**: 自动完成课程评教

## 🏗️ 项目结构

```
LNU-URP/
├── LNU-URP-Main.py          # 主程序入口（抢课功能）
├── SelectGrades.py          # 成绩查询专用程序
├── AutoAssess.py            # 自动评教专用程序
├── AccountInfo.py           # 账号信息配置文件
├── UrpUtils.py              # 核心功能模块
├── UrpNet.py                # 网络请求封装
├── UrpMD5.py                # MD5加密算法
├── GenerateTodoList.py      # 生成待选课程配置
├── TodoList.json            # 待选课程配置文件
└── README.md                # 项目文档（本文件）
```

## 📋 文件详细说明

### 核心文件

#### `LNU-URP-Main.py`
主程序入口文件，专注于抢课功能，包含：
- 免责声明和用户确认
- OCR初始化
- 登录流程控制
- 抢课主流程调用

#### `SelectGrades.py`
成绩查询专用程序，提供以下功能：
- 查询所有学期成绩
- 查询指定学期成绩
- 改进的错误处理（避免除零错误）
- 支持非数字成绩的处理

#### `AutoAssess.py`
自动评教专用程序，提供以下功能：
- 自动获取待评教课程列表
- 批量完成课程评教
- 智能解析评教问卷
- 自动提交评教结果

#### `AccountInfo.py`
账号信息配置文件：
- 统一管理账号和密码
- 供所有程序模块导入使用
- 便于账号信息的维护和更新

#### `UrpUtils.py`
核心功能模块，提供以下功能：
- `get_captcha()`: 验证码获取和识别
- `GetTokenValue()`: 获取登录令牌
- `md5_encode()`: 密码MD5加密
- `batch_select_courses()`: 批量选课主函数
- `select_single_course()`: 单课程选择
- `GetCourseGrades()`: 学分查询（已优化错误处理）
- `AutoAnswerQuestion()`: 自动答题
- `extract_question_ids()`: 提取评教问卷题目ID
- `get_token_from_html()`: 从HTML中提取token

#### `UrpNet.py`
网络请求封装模块：
- `Loop_GET()`: 带重试的GET请求
- `Loop_POST()`: 带重试的POST请求
- `Special_LOOP_POST()`: 特殊POST请求（用于评教）
- `Set_headers()`: 设置请求头

#### `UrpMD5.py`
MD5加密算法实现：
- `hex_md5()`: 主加密函数
- 其他辅助加密函数

### 配置文件

#### `TodoList.json`
待选课程配置文件格式：
```json
[
    {
        "courseNum": "1420013",
        "classNum": "01",
        "kcm": "",
        "dealType": "2"
    }
]
```

字段说明：
- `courseNum`: 课程编号
- `classNum`: 班级编号
- `kcm`: 课程名称编码（自动生成）
- `dealType`: 操作类型（"2"表示选课）

### 辅助工具

#### `GenerateTodoList.py`
用于生成待选课程配置文件的交互式工具。

## 🚀 快速开始

### 环境要求

- Python 3.7+
- Windows 系统（推荐）

### 依赖安装

```bash
pip install ddddocr requests beautifulsoup4
```

### 基本使用

1. **配置账号信息**
   
   编辑 `AccountInfo.py` 中的账号和密码：
   ```python
   account = "你的学号"
   password = "你的密码"
   ```

2. **生成待选课程列表**（仅抢课功能需要）
   
   运行生成工具：
   ```bash
   python GenerateTodoList.py
   ```
   
   按提示输入课程信息，生成 `TodoList.json` 文件。

3. **运行抢课脚本**
   
   ```bash
   python LNU-URP-Main.py
   ```
   
   按提示同意免责声明后，脚本将自动执行抢课流程。

4. **查询成绩**
   
   ```bash
   python SelectGrades.py
   ```
   
   按提示选择查询选项：
   - 查询所有学期成绩
   - 查询指定学期成绩

5. **自动评教**
   
   ```bash
   python AutoAssess.py
   ```
   
   脚本会自动获取待评教课程并完成评教。

## ⚙️ 高级配置

### 重试次数设置

在 `LNU-URP-Main.py` 中修改重试次数：
```python
result = UrpUtils.batch_select_courses(session, retry_times=2)
```

### 网络超时设置

在 `UrpNet.py` 中修改超时时间：
```python
rp = session.get(url, data=data, headers=headers, timeout=5)  # GET请求超时
rp = session.post(url, data=data, headers=headers, timeout=10)  # POST请求超时
```

### 验证码识别设置

在 `LNU-URP-Main.py` 中配置OCR：
```python
ocr = ddddocr.DdddOcr()
ocr.set_ranges(6)  # 设置验证码字符数量
```

## 🔧 技术特性

### 网络稳定性

- **自动重试机制**: 网络请求失败时自动重试
- **超时处理**: 设置合理的超时时间避免长时间等待
- **错误恢复**: 遇到网络错误时显示提示信息并继续重试

### 验证码处理

- **OCR自动识别**: 使用ddddocr库进行验证码识别
- **错误过滤**: 过滤常见的识别错误（如5位识别成4位）
- **临时文件管理**: 自动清理验证码图片临时文件

### 密码安全

- **MD5加密**: 使用自定义MD5算法对密码进行加密
- **兼容性**: 完全兼容辽宁大学教务系统的加密要求

## 📊 功能流程

### 登录流程

1. 获取登录页面和token
2. 下载并识别验证码
3. MD5加密密码
4. 提交登录表单
5. 验证登录状态

### 选课流程

1. 加载待选课程配置
2. 获取选课页面token
3. 获取课程详细信息
4. 批量提交选课请求
5. 处理选课结果

### 成绩查询流程

1. 登录教务系统
2. 显示查询选项菜单
3. 根据用户选择执行对应功能：
   - 所有成绩：获取全部学期成绩
   - 指定成绩：查询特定学期成绩

### 自动答题流程

1. 检测是否有待回答问卷
2. 自动填写问卷答案
3. 提交问卷结果

### 自动评教流程

1. 登录教务系统
2. 获取待评教课程列表
3. 对每门课程：
   - 获取评教问卷页面
   - 解析问卷题目ID
   - 提取页面token
   - 自动填写评分（满分）
   - 提交评教结果
4. 完成所有课程评教

## 🐛 常见问题

### Q: 验证码识别失败怎么办？

A: 验证码识别使用OCR技术，可能存在识别错误。脚本会自动重试，如果持续失败，可以：
- 检查网络连接
- 重新运行程序
- 手动检查验证码图片质量

### Q: 登录失败怎么办？

A: 登录失败可能的原因：
1. 账号密码错误
2. 验证码识别错误
3. 网络连接问题
4. 教务系统维护

检查账号密码是否正确，确保网络连接正常。

### Q: 选课失败怎么办？

A: 选课失败可能的原因：
1. 课程已满
2. 时间冲突
3. 学分不足
4. 课程编号错误

检查 `TodoList.json` 中的课程信息是否正确。

### Q: 如何查看选课结果？

A: 脚本会在控制台输出选课结果，包括成功和失败的课程信息。也可以登录教务系统查看实际选课状态。

## 🔄 更新日志

### 网络请求优化
- 将直接的requests调用替换为UrpNet模块的循环请求函数
- 提供更好的网络稳定性和容错能力
- 统一的错误处理和重试机制

### 功能改进
- 添加免责声明和用户确认机制
- 优化验证码识别准确率
- 改进选课成功率统计

## 📝 开发说明

### 代码结构

项目采用模块化设计：
- **主程序**: 控制整体流程
- **工具模块**: 提供具体功能实现
- **网络模块**: 处理HTTP请求
- **加密模块**: 处理密码加密

### 扩展开发

如需添加新功能：
1. 在 `UrpUtils.py` 中添加新的功能函数
2. 在 `LNU-URP-Main.py` 中调用新功能
3. 更新配置文件格式（如需要）

### 调试方法

- 在关键位置添加print语句输出调试信息
- 使用浏览器开发者工具分析网络请求
- 检查返回的HTML内容确认页面状态

## 📞 技术支持

如遇到技术问题，请：
1. 检查网络连接
2. 确认账号密码正确
3. 查看控制台错误信息
4. 参考常见问题章节

## ⚖️ 法律声明

本项目遵循以下原则：
- 仅供学习研究使用
- 不得用于商业用途
- 使用者承担使用风险
- 开发者不承担法律责任

请合理使用，遵守相关法律法规和学校规定。

---

**开发者**: Core_65536  
**项目版本**: 1.0  
**最后更新**: 2025年7月4日
